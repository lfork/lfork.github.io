# Android人脸识别闸机终端设备开发小结

## 业务难点

1、SDK的多样性，多SDK，多标准(镜像，旋转角度等。。)
解决方案：①对图像进行预处理(比如旋转或者镜像处理什么的，但是这样会减慢识别速度) ，
所以一般会把原始图片和原始图片的信息(大小，镜像什么的)直接给SDK，SDK使用NDK方式进行数据处理会快很多，而且也减少了中间转换的环节。

 ②针对各个SDK进行适配，这就很难受了，因为各个SDK的标准都不一样。

2、相机的多样性：针对不同的相机如何进行正确的预览？如何拿到正确角度的图片？如何显示任意大小的预览图像？

## 技术特点、难点

1、Android模块化：各个library之间的引用关系

2、线程池的大量应用：为啥？①线程池本身对线程的优点(线程复用，任务管理方便)  ②性能提升
单线程池，定时任务线程池，自定义线程池等

3、采用SignalR：为啥？项目的目的是实现和客户端和Web服务器实时通信(实时性不是特别高，几秒内都行)，现在的解决方案有:

①WebSocket实现(在http的基础上减少了无用信息的收发)，②HTTP轮询实现(资源耗费大)。所以最后就采用了WebSocket。
Android上的SignalR基于OkHttp对WebSocket进行了封装,API很简单。再加上，服务端也是ASP.NET平台的。
所以就采用了SignalR来进行实时数据推送。

4、基于Android的自定义View：渐变，旋转等。

5、Android相机开发：缓冲区的设置，画面自适应，图片旋转角度等。

6、如何保证采集到的RGB和IR图像帧时间差距小最小？双线程，等待机制。RGB采集线程，IR采集线程。单个

```java
private volatile byte[] rgbData;

private volatile byte[] irData;


//Thread1
private void onRgbPreviewFrameCallback(byte[] data){

    if(rgbData == null){
        rgbData = data;
    }

    doIdentify();
}

//Thread2
private void onIRPreviewFrameCallback(byte[] data){
    if(irData == null){
        irData = data;
    }
    doIdentify();
}



private void doIdentify(){

    if(rgbData == null || irData == null){
        return;
    }

    //do something
    //清空缓存
}


```

之前有种方式是先拿到RGB图像，然后等IR图像。。。还是对整个流程不了解出现的问题。

## 其他难点

1、使用的设备性能很差，定制设备，散热又不好，debug也很慢，对开发效率有影响

## 学到的东西

### 技术业务上

1、人脸识别终端程序的基本开发流程：图像采集(双摄像头)、

### 团队协作

1、单元测试一定要做到位

2、程序功能结构图画到位

3、沟通要到位，这次的这个项目感觉自己是在被减价劳动力，所以内心是有点反感的。所以沟通不是很到位，也增加了不少开发的成本。

### 反剥削

1、还是自己经验不足，不能正确的预估工程量，就很简单的答应开发了，项目的技术难点倒是不多，就是个搬砖项目，工程量不低，感觉浪费了不少学习其他知识的时间(大三下学期，在准备考研)，这个项目间间断断的搞了快小半年，总的开发时间应该也是有2个月。需求改了基本上3次...

2、工资给的也少(不到3000块)，并且浪费了很多其他的时间，总的来说还是亏了。

### 其他

1、关于校招的面试，我是把这个项目写在了我的简历上了，但是面试官问我的时候，自己答的并不是很好，
因为的确没怎么仔细思考过一些更深入的问题，也没怎么系统总结，大部分都是搬砖操作。
2、所以这篇blog就是为了以后的面试写的总结

3、【多思考】